# SOC-Automation-project

## üìñ Project Overview

This project automates a key Security Operations Center (SOC) workflow. It connects a security monitoring tool (Wazuh) with a Security Orchestration, Automation, and Response (SOAR) platform (TheHive) to automatically create and enrich incidents, significantly reducing manual effort for SOC analysts and accelerating response times.


## üõ†Ô∏è Tech Stack & Tools

*   **SIEM / EDR:** [Wazuh](https://wazuh.com/)
*   **SOAR Platform:** [Shuffle](https://shuffler.io/)
*   **Case Management:** [TheHive](https://strangebee.com/thehive/) (I didn configer it because i dont have enough RAMS )  
*   **Infrastructure:** Docker, Virtual Machines.




## üîÑ Automated Workflow Logic

The following diagram illustrates the automated incident response pipeline:

<img width="849" height="641" alt="image" src="https://github.com/user-attachments/assets/5d5146a7-6474-4410-ba25-0559aef1c4a2" />

## Configeration 
## 1. Wazuh Manager
- We began the project by establishing our core detection capability, deploying the Wazuh manager on an Ubuntu server virtual machine. This formed the foundation of our security monitoring, providing log analysis, intrusion detection, and vulnerability assessment for our endpoints.

<img width="1750" height="937" alt="image" src="https://github.com/user-attachments/assets/06e483a2-e1a3-48e9-81a2-3d3b87dcff49" />

## 2.Wazuh Agent
- Following the successful deployment of the Wazuh manager, the next critical step was to deploy and configure the Wazuh agents on our endpoint, a Windows 11 client. This involved installing the agent software and then securely registering it with the manager by specifying the manager's IP address. Once the agent-manager communication was established, the endpoint immediately began streaming vital security telemetry‚Äîincluding system logs, process activity, and network data‚Äîto the central manager for real-time analysis and correlation. This provided us with the essential visibility needed to detect potential threats.

<img width="1778" height="969" alt="image" src="https://github.com/user-attachments/assets/18a28c9e-5f31-447f-bccf-c76a1afc8c38" />
<img width="1769" height="871" alt="image" src="https://github.com/user-attachments/assets/2f566261-52ce-4e23-80f3-cd6495c3893d" />

- Opening windows event viewer to forword sysmon events from the agent to wazuh manager.
  
![5963116230397251224](https://github.com/user-attachments/assets/6b66b194-fe08-448a-9646-07fecb9d3d3b)

- Edit wazuh agent ossec.config file (need admin prevelige) .Then adding the IP adress of the manager to forword events.
  
![5963116230397251225](https://github.com/user-attachments/assets/cfa7b590-dae2-4781-a7ae-3dffdfed1054)

## 3.Configuring Wazuh Manager for SOAR Integration
- A critical step in enabling the automation pipeline was modifying the Wazuh manager's ossec.conf file. Specifically, we enabled the following directives:
  
<img width="747" height="830" alt="image" src="https://github.com/user-attachments/assets/0bd12597-e826-478f-93fd-e76994e71d64" />

- This setting ensures that all alerts generated by Wazuh's rules are written to a dedicated log file.
-<logall>yes</logall> and <logall_json>yes</logall_json>: These are the most important settings for a SOAR integration. By default, Wazuh only logs events that trigger a rule. Enabling logall instructs the manager to log all ingested events, regardless of whether they triggered an alert. Furthermore, setting logall_json to yes formats these logs in JSON, which is the standard and most easily parsed format for API-driven platforms like Shuffle. This provides the SOAR with the full, rich context of the original event, enabling more accurate and detailed automation.
- Enable filebeat archive 

<img width="945" height="752" alt="image" src="https://github.com/user-attachments/assets/97499f1a-4110-49c9-a3b4-fa63e8105d54" />

- As visible in the dashboard, the following key index patterns were created:
wazuh-alerts-*: Contains all security alerts generated by Wazuh's rule engine.
wazuh-archives-*: Stores the full, raw event logs, providing complete context for every alert.
wazuh-monitoring-*: Holds health and status data for all deployed Wazuh agents.

<img width="1783" height="890" alt="image" src="https://github.com/user-attachments/assets/284cd5f7-2011-40bb-8e46-09f0d44727b3" />

## Test Wazuh Alerts
- On windows 11 machine we downloaded mimikatz and start it with powershell.
- On wazuh manager we used [cat archive.json | grep mimikatz]

<img width="934" height="798" alt="image" src="https://github.com/user-attachments/assets/8cd9c2f4-699a-47b5-a7a2-590f2f86040f" />

- We opened Wazuh dashboard and search for mimikatz.

<img width="1765" height="986" alt="image" src="https://github.com/user-attachments/assets/2ce72aa6-852d-449f-9384-89ffc43a589f" />

## Create rules 
- On wazuh dashboard we opened rules file (local_rules.xml),and add rule to detect mimikatz with its (originalFileName) so that even if the name changed is still detected. I changed the name to fakename.exe

<img width="1772" height="566" alt="image" src="https://github.com/user-attachments/assets/ffc1ae4f-fcb6-46c2-9e7a-136fc18996fc" />
  
<img width="1671" height="953" alt="image" src="https://github.com/user-attachments/assets/a5e9e48e-7cb3-427c-8a7d-b7a0886b6f7e" />

- Run fakename.exe

<img width="1339" height="737" alt="image" src="https://github.com/user-attachments/assets/7112b122-08ad-4f45-9312-8dab79c13393" />
  
- Detect

<img width="1782" height="991" alt="image" src="https://github.com/user-attachments/assets/ef7fd3e4-22df-4201-bd06-28433f961d97" />

## Integreate to Shuffle SOAR

- We used Shuffle as our SOAR (Security Orchestration, Automation, and Response) platform. It acted as the brain of our automation, connecting all our tools together. When Wazuh detected a threat like Mimikatz, Shuffle would automatically:
- Grab the suspicious file's hash.
- Check it with VirusTotal.
- Create an alert in TheHive.
- Email the SOC team.
- This entire process happened automatically in Shuffle, turning separate tools into one seamless security system.

<img width="952" height="480" alt="image" src="https://github.com/user-attachments/assets/fdd21df7-e011-4ff6-9be6-3abf6f915323" />

- I configured the integration between Wazuh and Shuffle by editing the ossec.conf file on the Wazuh manager. This setup automatically sent security alerts to Shuffle whenever my custom rules were triggered, enabling the automated response workflow.<rule_id>100002<rule_id> 

<img width="947" height="586" alt="image" src="https://github.com/user-attachments/assets/6c6c07a6-703f-452c-a1dc-98c052f21841" />

<img width="1761" height="902" alt="image" src="https://github.com/user-attachments/assets/63180fa6-7aa0-4ba3-8022-5ec6d1c2c77e" />

<img width="991" height="380" alt="image" src="https://github.com/user-attachments/assets/37fb81cb-0ea8-4257-962c-7899e29bedf0" />


## üöÄ Key Features & Achievements

*   **Full Automation from Detection to Triage:** Eliminates the need for an analyst to manually create incidents in the SOAR platform.
*   **Intelligent Alert Enrichment:** Automatically enriches incidents with threat intelligence (IOCs) for better context and faster decision-making.
*   **Proactive Analyst Notification:** Immediately notifies the SOC team via email when a new, high-priority incident is created.
*   **Reduced Mean Time to Respond (MTR):** Cut down the time from initial detection to analyst awareness from several minutes to seconds.


